# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–¥–µ–ª–∫–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¢–í

## üìã –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥–µ–ª–∞–Ω –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è. –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¢–í —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–≥–∏–∫–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –ø—É–ª—å—Ç–æ–≤.

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚ùå –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
- –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª `frontend/src/pages/admin/TVInterfaceBuilder.tsx`
- –£—Å—Ç–∞—Ä–µ–≤—à–∞—è –ª–æ–≥–∏–∫–∞ —É–±—Ä–∞–Ω–∞

### 2. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ —Å –Ω—É–ª—è
- –ù–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ –æ–±—Ä–∞–∑—Ü—É `RemoteBuilder.tsx`
- –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ REST API
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ë–î, –Ω–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### 3. üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å—Ö–µ–º–∞ PostgreSQL:
```sql
CREATE TABLE tv_interfaces (
    id VARCHAR(255) PRIMARY KEY,
    device_id VARCHAR(255) REFERENCES devices(id),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    type VARCHAR(50) CHECK (type IN ('home', 'settings', 'channels', 'apps', 'guide', 'no-signal', 'error', 'custom')),
    screenshot_data TEXT, -- base64 encoded image
    clickable_areas JSONB DEFAULT '[]'::jsonb,
    highlight_areas JSONB DEFAULT '[]'::jsonb,
    responsive BOOLEAN DEFAULT false,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### 4. üîß Backend API (Node.js + Express)
–ü–æ–ª–Ω—ã–π REST API –ø–æ –æ–±—Ä–∞–∑—Ü—É –ø—É–ª—å—Ç–æ–≤:

#### –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä: `backend/src/controllers/tvInterfaceController.js`
- `GET /api/v1/tv-interfaces` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞
- `GET /api/v1/tv-interfaces/:id` - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ ID
- `POST /api/v1/tv-interfaces` - –°–æ–∑–¥–∞–Ω–∏–µ
- `PUT /api/v1/tv-interfaces/:id` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- `DELETE /api/v1/tv-interfaces/:id` - –£–¥–∞–ª–µ–Ω–∏–µ
- `POST /api/v1/tv-interfaces/:id/duplicate` - –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- `PATCH /api/v1/tv-interfaces/:id/toggle` - –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è
- `GET /api/v1/tv-interfaces/device/:deviceId` - –ü–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É
- `GET /api/v1/tv-interfaces/type/:type` - –ü–æ —Ç–∏–ø—É
- `GET /api/v1/tv-interfaces/:id/export` - –≠–∫—Å–ø–æ—Ä—Ç
- `POST /api/v1/tv-interfaces/import` - –ò–º–ø–æ—Ä—Ç

#### –ú–æ–¥–µ–ª—å: `backend/src/models/TVInterface.js`
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 5. üé® Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
–ù–æ–≤—ã–π `frontend/src/pages/admin/TVInterfaceBuilder.tsx`:

#### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- **–í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä** —Å Canvas API
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏** (clickable_areas)
- **–û–±–ª–∞—Å—Ç–∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∏** (highlight_areas)
- **–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** (base64)
- **–ü—Ä–∏–≤—è–∑–∫–∞ –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º**
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫**
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤**
- **–≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç JSON**

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞:
```typescript
// –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±–ª–∞—Å—Ç–µ–π
const handleCanvasClick = async (event: React.MouseEvent<HTMLCanvasElement>) => {
  const newElement: ClickableArea | HighlightArea = elementCreationType === 'clickable' 
    ? {
        id: `clickable_${Date.now()}`,
        name: elementFormData.name || "–ù–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å",
        position: { x, y },
        size: { width: 100, height: 50 },
        shape: elementFormData.shape,
        action: elementFormData.action || "click",
      }
    : {
        id: `highlight_${Date.now()}`,
        name: elementFormData.name || "–û–±–ª–∞—Å—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫–∏",
        position: { x, y },
        size: { width: 100, height: 50 },
        color: elementFormData.color,
        opacity: elementFormData.opacity,
        animation: elementFormData.animation,
      };
  
  await tvInterfacesAPI.update(selectedInterface.id, updateData);
};
```

### 6. üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π —à–∞–≥–æ–≤
–§–∞–π–ª `frontend/src/pages/admin/StepsManagerNew.tsx` —É–∂–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω:

```typescript
// –ó–∞–≥—Ä—É–∑–∫–∞ –¢–í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
const loadTVInterfacesForDevice = async (deviceId: string) => {
  const response = await tvInterfacesAPI.getByDevice(deviceId);
  if (response.success && response.data) {
    setTVInterfaces(response.data);
  }
};

// –í —Ñ–æ—Ä–º–µ —Å–æ–∑–¥–∞–Ω–∏—è —à–∞–≥–∞
<Select value={formData.tvInterfaceId} onValueChange={...}>
  <SelectItem value="none">–ë–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¢–í</SelectItem>
  {getAvailableTVInterfaces().map((iface) => (
    <SelectItem key={iface.id} value={iface.id}>
      {iface.name} ({iface.type})
    </SelectItem>
  ))}
</Select>
```

### 7. üì∫ –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
–§–∞–π–ª `frontend/src/pages/DiagnosticPageNew.tsx` –æ–±–Ω–æ–≤–ª–µ–Ω:

```typescript
// –ó–∞–≥—Ä—É–∑–∫–∞ –¢–í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è —à–∞–≥–∞
useEffect(() => {
  const loadTVInterface = async () => {
    if (currentStepData?.tvInterfaceId) {
      const response = await tvInterfacesAPI.getById(currentStepData.tvInterfaceId);
      if (response.success && response.data) {
        setCurrentTVInterface(response.data);
      }
    }
  };
  loadTVInterface();
}, [currentStepData?.tvInterfaceId]);

// –†–µ–Ω–¥–µ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
const renderTVInterface = () => {
  if (currentTVInterface) {
    return (
      <div className="relative w-full h-full">
        <img src={currentTVInterface.screenshot_data} />
        
        {/* –û–±–ª–∞—Å—Ç–∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ */}
        {currentTVInterface.highlight_areas.map((area) => (
          <div key={area.id} className={`absolute border-2 ${area.animation === 'pulse' ? 'animate-pulse' : ''}`} />
        ))}
        
        {/* –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ */}
        {currentTVInterface.clickable_areas.map((area) => (
          <div key={area.id} className="absolute border-2 border-green-400" />
        ))}
      </div>
    );
  }
};
```

### 8. üíæ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ API:
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ PostgreSQL
- API –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
- –ù–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è

## üîß API –∫–ª–∏–µ–Ω—Ç
–§–∞–π–ª `frontend/src/api/tvInterfaces.ts`:

```typescript
export const tvInterfacesAPI = {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
  async getAll(filters: TVInterfaceFilters = {}): Promise<PaginatedResponse<TVInterfaceAPI[]>>
  async getById(id: string): Promise<APIResponse<TVInterfaceAPI>>
  async create(data: CreateTVInterfaceData): Promise<APIResponse<TVInterfaceAPI>>
  async update(id: string, data: UpdateTVInterfaceData): Promise<APIResponse<TVInterfaceAPI>>
  async delete(id: string): Promise<APIResponse<void>>
  
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
  async duplicate(id: string, name?: string): Promise<APIResponse<TVInterfaceAPI>>
  async toggleStatus(id: string): Promise<APIResponse<TVInterfaceAPI>>
  async getByDevice(deviceId: string): Promise<APIResponse<TVInterfaceAPI[]>>
  async getByType(type: TVInterfaceAPI['type']): Promise<APIResponse<TVInterfaceAPI[]>>
  async export(id: string): Promise<TVInterfaceExportData>
  async import(data: TVInterfaceExportData): Promise<APIResponse<TVInterfaceAPI>>
};
```

## üìä –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
```typescript
export interface TVInterfaceAPI {
  id: string;
  device_id?: string;
  name: string;
  description: string;
  type: 'home' | 'settings' | 'channels' | 'apps' | 'guide' | 'no-signal' | 'error' | 'custom';
  screenshot_data?: string; // base64
  clickable_areas: ClickableArea[];
  highlight_areas: HighlightArea[];
  responsive: boolean;
  is_active: boolean;
  created_at: string;
  updated_at: string;
}

export interface ClickableArea {
  id: string;
  name: string;
  position: { x: number; y: number };
  size: { width: number; height: number };
  shape: 'rectangle' | 'circle' | 'polygon';
  action: string;
}

export interface HighlightArea {
  id: string;
  name: string;
  position: { x: number; y: number };
  size: { width: number; height: number };
  color: string;
  opacity: number;
  animation?: 'pulse' | 'glow' | 'blink' | 'none';
}
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
1. **–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¢–í** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥–µ–ª–∞–Ω –ø–æ –æ–±—Ä–∞–∑—Ü—É –ø—É–ª—å—Ç–æ–≤
2. **–í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä** - Canvas —Å –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤
3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - PostgreSQL —Å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏
4. **REST API** - –ø–æ–ª–Ω—ã–π CRUD —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —à–∞–≥–∞–º–∏** - –≤—ã–±–æ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ
6. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
7. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - —á–µ—Ä–µ–∑ API –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

### üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- **Backend**: Node.js + Express + PostgreSQL
- **Frontend**: React + TypeScript + Tailwind + Radix UI
- **API**: REST —Å –ø–æ–ª–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- **–†–µ–¥–∞–∫—Ç–æ—Ä**: Canvas API —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —á–µ—Ä–µ–∑ API

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤—Å–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è!
